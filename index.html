
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maru Dry Fruits | Navbar</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/popup.css">
<link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/nav.css">
    <link rel="stylesheet" href="./css/footer.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!--favicon  -->
    <link rel="icon" type="image/x-icon" href="./images/ChatGPT Image Oct 25, 2025, 11_03_51 AM (1).png">
</head>
<body>
    <!-- We have edit index.html -->
<div id="particle-background"></div>
    <!-- Header with Logo & Dark Mode -->
    <div id="header-placeholder"></div>
<!-- Navbar Start -->

<div id="navbar-placeholder"></div>

<!-- Page Content -->
<section class="hero-section">
  <h1>Welcome to Maru Dry Fruits</h1>
  <p>Enjoy the modern luxury experience üå∞</p>
  <a href="#product-start" class="cta-button">Shop Now</a>
</section>
<section class="filter-controls">
    <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All Products</button>
        <button class="filter-btn" data-filter="Nuts">Nuts</button>
        <button class="filter-btn" data-filter="Dried Fruit">Dried Fruit</button>
        <button class="filter-btn" data-filter="Dates">Dates</button>
    </div>
    
    <div class="search-bar">
        <input type="text" id="product-search" placeholder="Search products by name...">
    </div>
</section>

<section class="card-section" id="product-start">
    </section>

     <!-- popup-section -->
        <div class="popup-overlay" id="popupOverlay">
        <div class="popup">
    <span class="close" id="closePopup">&times;</span>

    <div class="popup-image">
        <img src="images/almonds.jpg" alt="Product Image" id="popupImg">
    </div>

    <div class="popup-details">
        <h2 id="popupName">Product Name</h2>
        <p id="popupDesc">Product short description goes here, detailing its benefits and uses.</p>
        
        <div class="popup-price-section">
            <span id="popupPrice" class="current-price">Rs. 999</span>
            <span id="popupCutPrice" class="old-price">Rs. 1200</span>
        </div>

        <div class="popup-quantity-size">
            <div class="quantity-control">
                <button class="minus">-</button>
                <input type="number" id="popupQty" value="1" min="1">
                <button class="plus">+</button>
            </div>
            
            <div class="popup-size-selector">
                <select id="popupSize">
                    <option value="250g">250g</option>
                    <option value="500g">500g</option>
                    <option value="1kg">1kg</option>
                </select>
            </div>
        </div>
    </div>

    <div class="popup-actions">
        <button id="addToCartBtn">Add to Cart</button>
    </div>
</div>
    </div>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top">
        <i class="fas fa-chevron-up"></i>
    </button>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const cardSection = document.getElementById('product-start');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const searchInput = document.getElementById('product-search');

  // Data
  let allProducts = [];

  // Safe: lucide icons (if script loaded earlier/later)
  if (window.lucide && typeof lucide.createIcons === 'function') {
    lucide.createIcons();
  }

  // Theme toggle guard (if your theme toggle exists)
  const toggleBtn = document.getElementById('themeToggle');
  if (toggleBtn) {
    let isLight = document.body.classList.contains('light-mode');
    toggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      isLight = !isLight;
      toggleBtn.innerHTML = `<i data-lucide="${isLight ? 'moon' : 'sun'}"></i>`;
      if (window.lucide && typeof lucide.createIcons === 'function') lucide.createIcons();
      toggleBtn.animate([{ transform: 'rotate(0deg)' }, { transform: 'rotate(180deg)' }], { duration: 500, fill: 'forwards' });
    });
  }

  // ---- Fetch products ----
  fetch('products.json')
    .then(response => {
      if (!response.ok) throw new Error('Network response was not ok. Check products.json path.');
      return response.json();
    })
    .then(products => {
      allProducts = products;
      console.log('‚úÖ Products loaded:', allProducts.length, 'items');
      renderCards(allProducts);
    })
    .catch(err => {
      console.error('‚ùå Error loading products:', err);
      if (cardSection) cardSection.innerHTML = `<h2 style="text-align:center; color:red; margin:50px;">Data Load Nahi Hua. products.json path check karein. (${err.message})</h2>`;
    });

  // ---- Render function ----
  function renderCards(productsToDisplay = []) {
    if (!cardSection) return console.error('cardSection element not found (id="product-start")');
    cardSection.innerHTML = '';

    if (!productsToDisplay || productsToDisplay.length === 0) {
      cardSection.innerHTML = '<p style="text-align:center; color:#888; padding:40px;">No products found.</p>';
      return;
    }

    productsToDisplay.forEach(product => {
      const priceHTML = `
        <div class="price-info">
          <span class="current-price">Rs. ${product.price}</span>
          ${product.old_price ? `<span class="old-price">Rs. ${product.old_price}</span>` : ''}
        </div>
      `;

      const cardHTML = `
        <div class="card-container" 
             data-product-id="${product.id}" 
             data-price="${product.price}" 
             data-old-price="${product.old_price || ''}"
             data-name="${escapeHtml(product.name)}" 
             data-image="${product.image}"
             data-desc="${escapeHtml(product.description)}"
             data-category="${escapeHtml(product.category)}">
          <div class="card">
            <img src="${product.image}" alt="${escapeHtml(product.name)}">
            <h4>${escapeHtml(product.name)}</h4>
            <p>${escapeHtml(product.description)}</p>
            ${priceHTML}
          </div>
          <button class="quick-shop">Quick Shop</button>
        </div>
      `;
      cardSection.insertAdjacentHTML('beforeend', cardHTML);
    });

    // After rendering, re-bind event logic
    initialize3DMouseEffect();
    initializePopupLogic();
    initializeScrollReveal();
  }

  // small helper to avoid injection issues for attributes
  function escapeHtml(str = '') {
    return String(str).replace(/[&<>"']/g, s => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
    }[s]));
  }

  // ---- Filtering / UI logic ----
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      filterButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const category = btn.dataset.filter;
      const filtered = category === 'all' ? allProducts : allProducts.filter(p => p.category === category);
      if (searchInput) searchInput.value = '';
      renderCards(filtered);
    });
  });

  if (searchInput) {
    searchInput.addEventListener('input', (e) => {
      const q = e.target.value.trim().toLowerCase();
      const searched = allProducts.filter(p =>
        p.name.toLowerCase().includes(q) ||
        p.description.toLowerCase().includes(q) ||
        (p.category && p.category.toLowerCase().includes(q))
      );
      // remove active from filter buttons when searching
      filterButtons.forEach(b => b.classList.remove('active'));
      renderCards(searched);
    });
  }

  // ---- 3D mouse effect initializer ----
  function initialize3DMouseEffect() {
    document.querySelectorAll('.card-container').forEach(card => {
      // remove previous listeners to avoid duplicates
      card.onmousemove = null;
      card.onmouseleave = null;

      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const rotationY = ((x - rect.width / 2) / (rect.width / 2)) * 15;
        const rotationX = ((y - rect.height / 2) / (rect.height / 2)) * -15;
        card.style.transform = `perspective(1000px) rotateX(${rotationX}deg) rotateY(${rotationY}deg) scale(1.05)`;
      });

      card.addEventListener('mouseleave', () => {
        card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1)';
      });
    });
  }

  // ---- Popup logic (uses .quick-shop buttons) ----
function initializePopupLogic() {
    const quickShopBtns = document.querySelectorAll('.quick-shop');
    const popupOverlay = document.querySelector('.popup-overlay');
    const closePopup = document.getElementById('closePopup');
    const popupImg = document.getElementById('popupImg');
    const popupTitle = document.getElementById('popupName');
    const popupPrice = document.getElementById('popupPrice');
    const popupOldPrice = document.getElementById('popupCutPrice');
    const popupDesc = document.getElementById('popupDesc');
    const popupSizes = document.getElementById('popupSize'); // size dropdown
    const qtyInput = document.getElementById('popupQty'); // quantity input
    const minusBtn = document.querySelector('.minus');
    const plusBtn = document.querySelector('.plus');

    quickShopBtns.forEach(btn => {
        btn.onclick = null;
        btn.addEventListener('click', () => {
            const card = btn.closest('.card-container');
            if (!card) return;

            const productId = card.dataset.productId;
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            // Set basic popup content
            if (popupImg) popupImg.src = product.image;
            if (popupTitle) popupTitle.textContent = product.name;
            if (popupDesc) popupDesc.textContent = product.description;

            // Populate sizes dynamically
            if (popupSizes) {
                popupSizes.innerHTML = '';
                product.sizes.forEach(size => {
                    const option = document.createElement('option');
                    option.value = size;
                    option.textContent = size;
                    popupSizes.appendChild(option);
                });
                // Default selection = 1kg if exists, else first size
                popupSizes.value = product.sizes.includes('1kg') ? '1kg' : product.sizes[0];
            }

            // Set default quantity
            if (qtyInput) qtyInput.value = 1;

            // Function to calculate total price based on size & quantity
            const updatePrice = () => {
                const selectedSize = popupSizes ? popupSizes.value : '1kg';
                const qty = qtyInput ? Math.max(1, parseInt(qtyInput.value) || 1) : 1;

                let sizeMultiplier = 1;
                if (selectedSize === '250g') sizeMultiplier = 0.25;
                else if (selectedSize === '500g') sizeMultiplier = 0.5;

                const totalPrice = Math.round(product.price * sizeMultiplier * qty);
                const totalOldPrice = Math.round(product.old_price * sizeMultiplier * qty);

                if (popupPrice) popupPrice.textContent = `Rs. ${totalPrice}`;
                if (popupOldPrice) popupOldPrice.textContent = `Rs. ${totalOldPrice}`;
            };

            // Initial price update
            updatePrice();

            // Update price on size change
            if (popupSizes) popupSizes.onchange = updatePrice;

            // Update price on quantity input
            if (qtyInput) {
                qtyInput.oninput = () => {
                    qtyInput.value = Math.max(1, parseInt(qtyInput.value) || 1);
                    updatePrice();
                };
            }

            // Plus / minus buttons
            if (minusBtn) minusBtn.onclick = () => {
                const current = parseInt(qtyInput.value) || 1;
                qtyInput.value = Math.max(1, current - 1);
                updatePrice();
            };
            if (plusBtn) plusBtn.onclick = () => {
                const current = parseInt(qtyInput.value) || 1;
                qtyInput.value = current + 1;
                updatePrice();
            };

            if (popupOverlay) popupOverlay.style.display = 'flex';
        });
    });

    // Close popup
    if (closePopup) {
        closePopup.onclick = () => {
            if (popupOverlay) popupOverlay.style.display = 'none';
        };
    }

    if (popupOverlay) {
        popupOverlay.addEventListener('click', e => {
            if (e.target === popupOverlay) popupOverlay.style.display = 'none';
        });
    }
}

  // ---- Scroll reveal (simple) ----
  function initializeScrollReveal() {
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('appear');
          obs.unobserve(entry.target);
        }
      });
    }, { threshold: 0.2 });

    document.querySelectorAll('.card-container').forEach(card => {
      if (!card.classList.contains('appear')) observer.observe(card);
    });
  }

  // End DOMContentLoaded
});

// Back to Top Functionality
document.addEventListener("DOMContentLoaded", function() {
  const backToTopButton = document.getElementById("backToTop");
  
  // Show/hide button based on scroll position
  window.addEventListener("scroll", function() {
    if (window.pageYOffset > 300) {
      backToTopButton.classList.add("show");
    } else {
      backToTopButton.classList.remove("show");
    }
  });
  
  // Smooth scroll to top
  backToTopButton.addEventListener("click", function() {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
});
</script>

<div id="footer-placeholder"></div>
<script src="./js/footer.js" defer></script>
    <script src="./js/popup.js" defer></script>
      <script src="./js/header.js"></script>

<!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
    <script src="./js/nav.js"></script>

</body>
</html>
